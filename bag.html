<html>

<!--

　　　          ___   .--.
　　　    .--.-"   "-' .- |
　　　   / .-,`          .'   
　　　   \   `           \ 　　　　　　。・゜ 　♡   。　　・　゜ 　　　♡  
　　　    '.            ・ \　　　　　　　　　　　　　　　　　　　　　　　　♡　　　　♡ ゜・。。♡  
　　　      |  ・     ᴥ    。|　　　　・゜♡ ゜・。　　. * ・ ♡ °  . 。
　　　      \ 。            /.____　　　　　　　　　　　　　　　　　　♡.  
　　　     /`-.          ,'.'    `\　　　　　　　　　　　　　　　　　　。・゜　　　 ♡ ・ 。　　。・゜ ♡  
　　　  __/   \`-.____.-' `\      /　　　　　♡　。・゜      
　　　  | `---`'-'._/-`     \----'    _ 　　　　　　　　　　　♡　　　.　　　.♡ 
　　　  |,-'`  /             |    _.-' `\　　　　. * ・        
　　　 .'     /              |--'`     / |　　　　　　　　　　 ♡
　　　/      /\              `         | |
　　　|   .\/  \      .--. __          \ |　　　　　　　　　　　*.。middlepot.com 
　　　 '-'      '._       /  `\         /　　　　　　　　　　　　　　　　　　　　　　　ଘ(*´ ˘ `*)ഒ 。.*
　　　             `\    '     |------'`
　　　               \  |      |
　　　                \        /
 　　　                '._  _.'

-->

<title>shy bunny store ꒱</title>

<head>
<link rel="shortcut icon" href="./img/favicon.png">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="title" content="ꔫ">
<meta name="description" content="shy bunny store ꒱">
<meta name="theme-color" content="#f7e9ed">
<meta property="og:url" content="https://shybunny.store">
<meta property="og:title" content="ꔫ">
<meta property="og:description" content="shy bunny store ꒱">
<meta property="og:image" content="https://middlepot.com/img/delicate.jpg">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:type" content="website">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://shybunny.store">
<meta property="twitter:title" content="ꔫ">
<meta property="twitter:description" content="shy bunny store ꒱">
<meta property="twitter:image" content="https://middlepot.com/img/delicate.jpg">

<script language= "JavaScript">
location.href="https://shybunny.store/bag"
</script>

<meta name="google-site-verification" content="XSwoCWBrpJECWQJaaNREq2GeweamSFmo78j2dJ_F3AA" />

<style>
body{ 
  cursor: url(./img/cursor.png), progress;}
a:hover, .hoverable:hover{cursor: url(./img/cursorhover.png), progress;}
 ::selection {text-shadow: 0 0 2px #cec1bb;color:#cec1bb}
 ::-moz-selection {text-shadow: 0 0 2px #cec1bb;color:#cec1bb}
</style>

<style>
	table, tr, td{
		text-align: center;
		font-size: 9pt;
		height: 50px;
		margin: 0;
		padding: 0;
	}
</style>

<style type="text/css">
::-webkit-scrollbar {
width: 5px;
height: 4px;
background: transparent;
}
::-webkit-scrollbar-thumb {
background-color: #fcf7f7;
-webkit-border-radius: 3ex;
border-radius: 3ex;
border: 1px dotted #baaeab;
}
</style>
<style>
html {
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
}

@media screen and (max-width: 1000px) and (orientation: portrait){
#everything { position: absolute; zoom: 255%;
	left:-350px; top:70px;}
}
@media screen and (min-width: 1700px) and (orientation: landscape){
#everything { position: absolute; zoom: 120%;
	left:150px;
	top:40px; }
}
@media screen and (min-width: 2000px) and (orientation: landscape){
#everything { position: absolute; zoom: 100%;
	left:-150px; top:10px;}
}
@media screen and (min-width: 3000px) and (orientation: landscape){
#everything { position: absolute; zoom: 240%;
	left:150px;
	top:40px; }
}
@media screen and (max-width: 1000px) and (orientation: landscape){
#everything { position: absolute; zoom: 85%; left:-100px; top:0px;}
}
</style>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
<script src="js/jimp.js"></script>
<script src="js/cookies.js"></script>
<script src="js/store-variables.js"></script>
<script>
	function showShippingWarning(){
		var whiteoverlay = document.createElement('div');
		whiteoverlay.id = 'shippingWarningOverlay';
		whiteoverlay.style.position = 'fixed';
		whiteoverlay.style.display = 'flex';
		whiteoverlay.style.justifyContent = 'center';
		whiteoverlay.style.alignItems = 'center';
		whiteoverlay.style.width = '100%';
		whiteoverlay.style.height = '100%';
		whiteoverlay.style.top = '0';
		whiteoverlay.style.left = '0';
		whiteoverlay.style.background = 'rgba(255, 255, 255, 0.3)';
		whiteoverlay.style.zIndex = '999990';
		$(whiteoverlay).insertAfter('head');

		var warning = document.createElement('img');
		warning.id = 'shippingWarningMessage';
		warning.src = './img/shippingwarning.png';
		warning.style.position = 'absolute';
		warning.style.display = 'block';
		warning.style.top = '190px';
		warning.style.left = '500px';
		warning.style.zIndex = '999991';
		$('#everything').append(warning);

		var close = document.createElement('img');
		close.id = 'shippingWarningClose';
		close.src = './img/bagdelete.png';
		close.style.position = 'absolute';
		close.style.display = 'block';
		close.style.top = '200px';
		close.style.left = '720px';
		close.style.zIndex = '999992';
		close.onclick = function(){
			$('#shippingWarningOverlay')[0].remove();
			$('#shippingWarningMessage')[0].remove();
			$('#shippingWarningClose')[0].remove();
		}
		$('#everything').append(close);
	}

	var loadedPaypalSdk = false;
	var buyerCurrency = 'USD';
	var buyerCountry = 'unknown';
	async function loadPaypalSdk(){
		var base_url = 'https://www.paypal.com/sdk/js?client-id=AaJ_j9vf-Z4jI8C7WrbP81WAsXm7HaMGEtFjvostBsdRBze1xJv3DbSX7DasVPtYVar3urkgUhiX3_2Z&components=buttons,funding-eligibility';
		var req = await fetch(api_path+'/currency', {method: 'GET'});
		var res = await req.json();
		buyerCurrency = res.currency;
		buyerCountry = res.country;
		if(buyerCountry === 'BR')
			base_url += '&currency=BRL';
		var scrEl = document.createElement('script');
		scrEl.src = base_url;
		scrEl.onload = function(){
			loadedPaypalSdk = true;
		}
		var head = document.head || document.getElementsByTagName("head")[0];
		head.insertBefore(scrEl, head.firstChild);

		//check if must show warning
		var shippingRestricted = ['AR', 'AU', 'NZ', 'PH'];
		if(buyerCountry === 'unknown' || shippingRestricted.includes(buyerCountry)){
			showShippingWarning();
		}
	}
	loadPaypalSdk();
	</script>
</head>

<body ondragstart="return false" style="background-image:url(./img/bg.png); background-repeat: repeat; font-family: Calibri; font-size: 11px; letter-spacing:1px; color:#998585; white-space: nowrap;">
<div id="everything">

<script>
	function validateEmail(email) {
		var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
		var test = re.test(String(email).toLowerCase());
		var mailValidatorEl = document.getElementById('emailvalidator');
		if(test){
			mailValidatorEl.src = 'img/couponok.png';
		}
		else{
			mailValidatorEl.src = 'img/couponwrong.png';
			var mailInputEl = document.getElementById('buyermail');
			mailInputEl.placeholder = 'please type a valid email !';
		}
		mailValidatorEl.style.display = 'block';
		return test;
	}

	function getCritterType(item){
		for(const [CRITTER] of Object.entries(critters)){
			if(item.critter === critters[CRITTER].NAME){
				return CRITTER;
			}
		}
	}

	//returns the weight of ithe item
	function getItemWeight(cat){
		for(const [CATEGORY] of Object.entries(categories)){
			if(cat === categories[CATEGORY].CATEGORY){
				return categories[CATEGORY].WEIGHT;
			}
		}
	}

	//returns the weight of ithe item
	function getItemPrice(cat){
		for(const [CATEGORY] of Object.entries(categories)){
			if(cat === categories[CATEGORY].CATEGORY){
				return categories[CATEGORY].PRICE;
			}
		}
	}

	//iterate over cart to evaluate shipping
	function calculateShipping(){
		var packagePrice = 5;
		var packageMaxWeight = 50;
		var finalPrice = 0;
		var packageCount = 1;
		var insidePackage = 0;
		cart_items.forEach(item =>{
			if(item){
				for(const [ITEM] of Object.entries(categories)){
					if(item.category === categories[ITEM].CATEGORY){
						insidePackage += categories[ITEM].WEIGHT;
						if(insidePackage > packageMaxWeight){
							insidePackage = categories[ITEM].WEIGHT;
							packageCount += 1;
						}
						break;
					}
				}
			}
		});
		if(packageCount >= 5)
			finalPrice += 30; //30usd for a box
		else
			finalPrice = (packagePrice*packageCount);
		var mode = packageCount+' package';
		if(packageCount > 1)
			mode += 's';
		var boxes = Math.floor(packageCount/5);
		if(boxes > 0){
			mode = '1 box';
		}
		return {total: finalPrice, mode: mode};
	}

	//iterate over cart to evaluate price
	function calculateItemsPrice(){
		var finalPrice = 0;
		cart_items.forEach(item =>{
			if(item){
				for(const [ITEM] of Object.entries(categories)){
					if(item.category === categories[ITEM].CATEGORY){
						finalPrice += categories[ITEM].PRICE;
						break;
					}
				}
			}
		});
		return finalPrice;
	}

	async function calculateFinalPrice(){
		//sets shipping fee
		var shipping = calculateShipping();
		var shippingEl = document.getElementById('shipping-total');
		shippingEl.innerHTML = '$ '+shipping.total+' usd ( ' + shipping.mode + ' )';
		//gets final price
		var total = (calculateItemsPrice()+shipping.total);
		var totalDiscounted = total*(1-(appliedDiscount/100));
		var totalFloat = parseFloat(total);
		var totalDiscountedFloat = parseFloat(totalDiscounted);
		if(totalDiscountedFloat % 1 !== 0)
			totalDiscountedFloat = totalDiscountedFloat.toFixed(2);
		
		var totalEl = document.getElementById('grand-total');
		if(!appliedDiscount || appliedDiscount <= 0){
			totalEl.innerHTML = '$ '+totalFloat+' usd';
			return totalFloat;
		}
		else{
			totalEl.innerHTML = '$ <span style="text-decoration: line-through;">'+totalFloat+'</span> '+totalDiscountedFloat+' usd';
			return parseFloat(totalDiscounted);
		}
	}
	
	function removeFromCart(){
		var clicked = $(this).closest('td').parent()[0].sectionRowIndex;
		if(clicked >= 0){
			cart_items.splice(clicked, 1);
			setCookie("cart_items", JSON.stringify(cart_items));
			updateCart();
		}
	}
	
	async function updateCart(){
		//pomisify jimp image creation
		var JimpCreate = (w, h) => new Promise((resolve) => {new Jimp(w, h, function(err, img){resolve(img);})});
		var prevEl = document.getElementById('table-preview');
		var typeEl = document.getElementById('table-type');
		var quantEl = document.getElementById('table-quantity');
		var weightEl = document.getElementById('table-weight');
		var totalWeight = 0;
		var tr, td;
		//clear tables
		document.getElementById('table-remove').innerHTML = '';
		document.getElementById('table-preview').innerHTML = '';
		document.getElementById('table-type').innerHTML = '';
		document.getElementById('table-price').innerHTML = '';
		document.getElementById('table-quantity').innerHTML = '';
		document.getElementById('table-weight').innerHTML = '';
		if(!cart_items || cart_items.length <= 0){
			document.getElementById('tables').style.display = 'none';
			document.getElementById('bag-state').src = 'img/bagempty.png';
			document.getElementById('shipping-total').remove();
			document.getElementById('buyermail').remove();
			document.getElementById('coupon').remove();
			document.getElementById('emailvalidator').remove();
			document.getElementById('grand-total').remove();
			document.getElementById('coupon-status').remove();
		}
		else{
			document.getElementById('tables').style.display = 'block';
			document.getElementById('bag-state').src = 'img/bagfull.png';
			for(var i = 0; i < cart_items.length; ++i){
				var item = cart_items[i];
				//remove
				tr = document.createElement('tr');
				td = document.createElement('td');
				var img = document.createElement('img');
				img.src = 'img/bagdelete.png';
				img.classList.add('hoverable');
				img.onclick = removeFromCart;
				td.appendChild(img);
				tr.appendChild(td);
				document.getElementById('table-remove').appendChild(tr);
				//create preview
				var critterType = getCritterType(item);
				var jimg;
				var bgBoxSize = 50;
				var baseOffset = 10;
				switch(item.category){
					case categories.STUFFIE.CATEGORY:{
						//critter
						var jimg, jbody, jhead, jarm;
						var jimgprom = JimpCreate(300, 340).then(img => jimg = img);
						var bodyprom = Jimp.read(critters[critterType].BODY).then(img => jbody = img);
						var armprom = Jimp.read(critters[critterType].ARMS[item.variation]).then(img => jarm = img);
						var headprom = Jimp.read(critters[critterType].HEAD).then(img => jhead = img);
						await Promise.all([jimgprom, bodyprom, headprom, armprom]);
						//makes critter
						jimg.composite(jbody, baseOffset, baseOffset);
						if(item.accessory >= 0 && item.accessory < critters[critterType].ACCESSORIES.length){
							//load accessory
							var acc = critters[critterType].ACCESSORIES[item.accessory];
							var jacc = await Jimp.read(acc.IMG);
							//if arm is behind accessory
							if(!critters[critterType].ACCESSORIES[item.accessory].BEHIND_ARMS[item.variation]){
								if(item.variation === 2) //this arm is above face
									jimg.composite(jhead, baseOffset, baseOffset);
								jimg.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2) //this arm is below face
									jimg.composite(jhead, baseOffset, baseOffset);
								//accessory
								jimg.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
							}
							else{
								//arm above accessory
								if(item.variation === 2){ //this arm is above face
									jimg.composite(jhead, baseOffset, baseOffset);
									jimg.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
								jimg.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2){ //this arm is below face
									jimg.composite(jhead, baseOffset, baseOffset);
									jimg.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
							}
						}
						else{
							//there are no accessories
							if(item.variation === 2) //this arm is above face
								jimg.composite(jhead, baseOffset, baseOffset);
							jimg.composite(jarm, baseOffset, baseOffset);
							if(item.variation < 2) //this arm is below face
								jimg.composite(jhead, baseOffset, baseOffset);
						}
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
					case categories.PIN.CATEGORY:{
						//critter
						var jimg, jcrit;
						var jimgprom = JimpCreate(300, 400).then(img => jimg = img);
						var imgprom = Jimp.read(critters[critterType].HEAD).then(img => jcrit = img);
						await Promise.all([jimgprom, imgprom]);
						if(item.accessory >= 0 && item.accessory < critters[critterType].ACCESSORIES.length){
							var acc = critters[critterType].ACCESSORIES[item.accessory];
							var jacc = await Jimp.read(acc.IMG);
							jcrit.composite(jacc, acc.POSX, acc.POSY);
						}
						//adds critter to preview
						jimg.composite(jcrit, baseOffset, baseOffset);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.65, bgBoxSize*0.65);

						break;
					}
					case categories.CHARM.CATEGORY:{
						//critter
						var jimg, jcrit, jbase, jbody, jhead, jarm;
						var baseprom = Jimp.read('img/charmbase.png').then(img => jbase = img);
						var jimgprom = JimpCreate(300, 340).then(img => jimg = img);
						var critprom = JimpCreate(300, 340).then(img => jcrit = img);
						var bodyprom = Jimp.read(critters[critterType].BODY).then(img => jbody = img);
						var armprom = Jimp.read(critters[critterType].ARMS[item.variation]).then(img => jarm = img);
						var headprom = Jimp.read(critters[critterType].HEAD).then(img => jhead = img);
						await Promise.all([jimgprom, critprom, baseprom, bodyprom, headprom, armprom]);
						//makes critter
						jcrit.composite(jbody, baseOffset, baseOffset);
						if(item.accessory >= 0 && item.accessory < critters[critterType].ACCESSORIES.length){
							//load accessory
							var acc = critters[critterType].ACCESSORIES[item.accessory];
							var jacc = await Jimp.read(acc.IMG);
							//if arm is behind accessory
							if(!critters[critterType].ACCESSORIES[item.accessory].BEHIND_ARMS[item.variation]){
								if(item.variation === 2) //this arm is above face
									jcrit.composite(jhead, baseOffset, baseOffset);
								jcrit.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2) //this arm is below face
									jcrit.composite(jhead, baseOffset, baseOffset);
								//accessory
								jcrit.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
							}
							else{
								//arm above accessory
								if(item.variation === 2){ //this arm is above face
									jcrit.composite(jhead, baseOffset, baseOffset);
									jcrit.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
								jcrit.composite(jarm, baseOffset, baseOffset);
								if(item.variation < 2){ //this arm is below face
									jcrit.composite(jhead, baseOffset, baseOffset);
									jcrit.composite(jacc, baseOffset+acc.POSX, baseOffset+acc.POSY);
								}
							}
						}
						else{
							//there are no accessories
							if(item.variation === 2) //this arm is above face
								jcrit.composite(jhead, baseOffset, baseOffset);
							jcrit.composite(jarm, baseOffset, baseOffset);
							if(item.variation < 2) //this arm is below face
								jcrit.composite(jhead, baseOffset, baseOffset);
						}
						//adds critter to preview
						jbase.resize(Jimp.AUTO, categories.CHARM.PREVIEW.BASE.HEIGHT);
						jcrit.resize(Jimp.AUTO, categories.CHARM.PREVIEW.HEIGHT);
						jcrit.autocrop();
						jimg.composite(jbase, jimg.bitmap.width/2-jbase.bitmap.width/2, baseOffset);
						jimg.composite(jcrit, jimg.bitmap.width/2-jcrit.bitmap.width/2, baseOffset+jbase.bitmap.height-40);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
					case categories.EARRING.CATEGORY:{
						//critter
						var jimg, jbase, jcrit;
						var jimgprom = JimpCreate(300, 400).then(img => jimg = img);
						var baseprom = Jimp.read('img/earringbase.png').then(img => jbase = img);
						var imgprom = Jimp.read(critters[critterType].HEAD).then(img => jcrit = img);
						await Promise.all([jimgprom, baseprom, imgprom]);
						if(item.choker_accessory >= 0 && item.choker_accessory < critters[critterType].CHOKER_ACCESSORIES.length){
							var acc = critters[critterType].CHOKER_ACCESSORIES[item.choker_accessory];
							var jacc = await Jimp.read(acc.IMG);
							jcrit.composite(jacc, acc.POSX, acc.POSY);
						}
						//adds critter to preview
						jcrit.resize(Jimp.AUTO, categories.EARRING.PREVIEW.HEIGHT);
						jbase.resize(Jimp.AUTO, categories.EARRING.PREVIEW.BASE.HEIGHT);
						var offx1 = 10;
						jimg.composite(jbase, baseOffset+offx1, baseOffset);
						jimg.composite(jcrit, baseOffset+categories.EARRING.PREVIEW.LEFT-jcrit.bitmap.width/2, baseOffset+categories.EARRING.PREVIEW.TOP);
						var offx2 = 80;
						jimg.composite(jbase, baseOffset+offx2, baseOffset);
						jimg.composite(jcrit, baseOffset+offx2-offx1+categories.EARRING.PREVIEW.LEFT-jcrit.bitmap.width/2, baseOffset+categories.EARRING.PREVIEW.TOP);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
					case categories.CHOKER.CATEGORY:{
						//critter
						var jbase, jcrit;
						var jimgprom = JimpCreate(500, 500).then(img => jimg = img);
						var baseprom = Jimp.read(chokers[item.choker_variation]).then(img => jbase = img);
						var imgprom = Jimp.read(critters[critterType].HEAD).then(img => jcrit = img);
						await Promise.all([jimgprom, baseprom, imgprom]);
						if(item.choker_accessory >= 0 && item.choker_accessory < critters[critterType].CHOKER_ACCESSORIES.length){
							var acc = critters[critterType].CHOKER_ACCESSORIES[item.choker_accessory];
							var jacc = await Jimp.read(acc.IMG);
							jcrit.composite(jacc, acc.POSX, acc.POSY);
						}
						//adds critter to preview
						jcrit.resize(Jimp.AUTO, categories.CHOKER.PREVIEW.HEIGHT);
						jbase.resize(categories.CHOKER.PREVIEW.BASE.WIDTH, Jimp.AUTO);
						jimg.composite(jbase, jimg.bitmap.width/2-jbase.bitmap.width/2, 20);
						jimg.composite(jcrit, categories.CHOKER.PREVIEW.LEFT-jcrit.bitmap.width/2, categories.CHOKER.PREVIEW.TOP);
						jimg.autocrop();
						jimg.scaleToFit(bgBoxSize*0.8, bgBoxSize*0.8);

						break;
					}
				}
				//applies bg and converts to base64
				var bg = await Jimp.read('img/bagbox.png');
				bg.composite(jimg, bg.bitmap.width/2-jimg.bitmap.width/2, (bg.bitmap.height-jimg.bitmap.height)/2);
				bg.getBase64Async(Jimp.MIME_PNG)
				.then(bg64 =>{
					tr = document.createElement('tr');
					td = document.createElement('td');
					img = document.createElement('img');
					img.src = bg64;
					img.name = 'item-preview';
					td.appendChild(img);
					tr.appendChild(td);
					document.getElementById('table-preview').appendChild(tr);
				});
				//type
				tr = document.createElement('tr');
				td = document.createElement('td');
				td.innerHTML = item.category;
				tr.appendChild(td);
				document.getElementById('table-type').appendChild(tr);
				//price
				tr = document.createElement('tr');
				td = document.createElement('td');
				td.innerHTML = '$'+getItemPrice(item.category);
				tr.appendChild(td);
				document.getElementById('table-price').appendChild(tr);
				//quantity
				tr = document.createElement('tr');
				td = document.createElement('td');
				td.innerHTML = 1;
				tr.appendChild(td);
				document.getElementById('table-quantity').appendChild(tr);
				//weight
				tr = document.createElement('tr');
				td = document.createElement('td');
				var w = getItemWeight(item.category);
				if(!isNaN(w) && isFinite(w)){
					td.innerHTML = w+'g';
					totalWeight += w;
				}
				tr.appendChild(td);
				document.getElementById('table-weight').appendChild(tr);
			}
			//total weight
			tr = document.createElement('tr');
			td = document.createElement('td');
			td.innerHTML = '<b>total weight :</b>';
			tr.appendChild(td);
			document.getElementById('table-quantity').appendChild(tr);
			tr = document.createElement('tr');
			td = document.createElement('td');
			td.innerHTML = '<b>'+totalWeight+'g</b>';
			tr.appendChild(td);
			document.getElementById('table-weight').appendChild(tr);
			//sets final price
			calculateFinalPrice();
		}
	}

	//load cart from to cookies
	function loadCart(){
		if(!loadingSomething){
			var cartCookie = getCookie("cart_items");
			if(cartCookie){
				var cart = JSON.parse(cartCookie);
				if(Array.isArray(cart) && cart.length > 0){
					cart_items = cart;
				}
			}
			updateCart();
		}
		else{
			setTimeout(loadCart, 50); //retry in 50ms
		}
	}

	function clearCart(){
		setCookie("cart_items", JSON.stringify([]));
		deleteCookie("cart_items");
	}

	var oldCouponCode = '';
	var appliedDiscount = 0;
	async function checkCoupon(){
		var couponEl = document.getElementById('coupon');
		var code = couponEl.value;
		var statusEl = document.getElementById('coupon-status');
		if(code){
			oldCouponCode = code;
			var req = await fetch(api_path+'/coupon?code='+code, {method: 'GET'});
			var res = await req.json();
			if(res && res.discount){
				statusEl.style.display = 'block';
				statusEl.src = 'img/couponok.png';
				appliedDiscount = res.discount;
			}
			else{
				statusEl.style.display = 'block';
				statusEl.src = 'img/couponwrong.png';
				appliedDiscount = 0;
			}
		}
		else if(oldCouponCode){
			statusEl.style.display = 'block';
			statusEl.src = 'img/couponwrong.png';
			appliedDiscount = 0;
		}
		calculateFinalPrice();
	}
</script>

<img style="position: absolute;
	left: 340px;
	top: 20px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 1;" src="./img/shoppingbag.png">

<a href="/policies">
<img style="position: absolute;
	left: 350px;
	top: 450px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/privacybutton.png"></a>

<a href="/">
<img style="position: absolute;
	left: 365px;
	top: 485px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/homeleft.png"></a>

<img id="bag-state" style="position: absolute;
	left: 475px;
	top: 165px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/bagfull.png">

<div id="tables" style="position: absolute; left: 450px; top: 190px;
overflow: auto; overflow: scroll; z-index: 5; width:370px; height:175px;
background: transparent; resize: none; outline:none;
border: 0px; color: #917979; font-family: Calibri;
font-size: 11px; letter-spacing:1px; line-height:20px;">

<div style="position: absolute; left:10px; right:10px;">
	<div style="display: flex;">
		<table id="table-remove" style="position: relative;"></table>
		<table id="table-preview" style="position: relative;"></table>
		<table id="table-type" style="position: relative;"></table>
		<table id="table-quantity" style="position: relative;"></table>
		<table id="table-price" style="position: relative; left: 10px;"></table>
		<table id="table-weight" style="position: relative; left: 55px;"></table>
	</div>
</div>

</div>

<p id="shipping-total" style="font-size: 10pt; font-weight: bold; text-align: right; position: absolute; top: 350px; left: 625px; z-index: 20;"></p>
<p id="grand-total" style="font-size: 11pt; font-weight: bold; text-align: right; position: absolute; top: 475px; left: 530px; z-index: 20;"></p>

<style>
::placeholder { color:#bda4a4; opacity: 1; }
::-ms-input-placeholder { color:#bda4a4; opacity: 1; }
</style>

<input id="buyermail" maxlength="50" style="position: absolute; left: 620px; top: 413px;
overflow: hidden; z-index: 5; width: 155px; height:20px;
background: transparent; resize: none; padding:5px; outline:none;
border: 0px; cursor: url(./img/cursorwrite.png), progress; font-family: Calibri;
font-size: 11px; color:#998585; letter-spacing:1px; line-height:15px; font-weight:bold;" oninput="validateEmail(this.value);"></input>

<img id="emailvalidator" style="display: none; z-index: 20; position: absolute; top: 420px; left: 785px;">

<input id="coupon" maxlength="8" style="position: absolute; left: 638px; top: 456px;
overflow: hidden; z-index: 5; width: 65px; height:20px;
background: transparent; resize: none; padding:5px; outline:none;
border: 0px; cursor: url(./img/cursorwrite.png), progress; color: #fff; font-family: Calibri;
font-size: 11px; letter-spacing:1px; line-height:15px; font-weight:bold;" onblur="checkCoupon();"></input>

<img id="coupon-status" style="display: none; z-index: 20; position: absolute; top: 458px; left: 715px;">

<img id="bag-total" style="position: absolute;
	left: 475px;
	top: 410px;
overflow-y:hidden;
overflow-x:hidden;
z-index: 2;" src="./img/bagtotal.png">

<img id="notebag" src="./img/notebag.png" style="position: absolute; z-index: 2; top: 565px; left: 685px;">

<script>loadCart();</script>
<!-- Add the checkout buttons, set up the order and approve the order -->
<div id="paypal-payment-methods">
	<img src="./img/checkoutback.png" style="position: absolute; z-index: 2; top: 525px; left: 485px;">
	<img src="./img/checkoutpaypal.png" style="pointer-events: none; position: absolute; z-index: 4; top: 529px; left: 489px;">
	<img src="./img/checkoutcredit.png" style="pointer-events: none; position: absolute; z-index: 4; top: 574px; left: 489px;">
</div>
<div id="paypal-container" style="z-index: 3; width: 175px; position: absolute; top: 530px; left: 490px;">
	<div class="hoverable" id="paypal-button-container"></div>
	<div class="hoverable" id="card-button-container" style="margin-top: 5px;"></div>
</div>
<script>
	var paypalButtons = [];
	var buyerCardRestricted = false;
	function loadPaypalButtons(){
		if(loadedPaypalSdk){
			var FUNDING_SOURCES = [
				paypal.FUNDING.PAYPAL
			];
			//check buyer country to determine available payment
			var cardRestrictedCountries = ['BR', 'JP', 'RU'];
			buyerCardRestricted = cardRestrictedCountries.includes(buyerCountry);
			if(!buyerCardRestricted){
				//enable card payment
				FUNDING_SOURCES.push(paypal.FUNDING.CARD);
			}
			//restricted
			else{
				//check if from brazil
				/* if(buyerCurrency == 'BRL'){

				}
				else{
					
				} */
				var el = $(`<img src="./img/jprussiacheckout.png" style="pointer-events: none; position: absolute; z-index: 4; top: 524px; left: 485px;">`);
				$('#paypal-payment-methods').empty().append(el);
				$('#notebag')[0].src = './img/jprussianotebag.png';
			}

			// Loop over each funding source/payment method
			FUNDING_SOURCES.forEach(function(fundingSource) {
				// Initialize the buttons
				var divContainer = fundingSource === paypal.FUNDING.PAYPAL?'#paypal-button-container':'#card-button-container';
				var button = paypal.Buttons({
					fundingSource: fundingSource,
					style:{
						tagline: false,
						height: 40
					},
					createOrder: async function (data, actions) {
						var catcart = [];
						cart_items.forEach(item =>{
							catcart.push(item.category);
						});
						var code = document.getElementById('coupon').value;
						var priceFetch = await fetch(api_path+'/order/price', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({cart: catcart, coupon: code})
						});
						var resp = await priceFetch.json();
						updatedPrice = resp.price;
						var convReq = await fetch(api_path+'/currency/conversion?amt='+updatedPrice, {method: 'GET'});
						var convRes = await convReq.json();
						var currency = convRes.currency;
						var finalValue = convRes.amount;
						return actions.order.create({
							purchase_units: [{
								amount: {
									value: finalValue,
									currency_code: currency
								}
							}]
						});
					},
					onClick: function(){
						var buyerMailEl = document.getElementById('buyermail');
						var buyerMail = buyerMailEl.value;
						if(!validateEmail(buyerMail)){
							//invalid email
							buyerMailEl.value = '';
							return false;
						}
					},
					onApprove: function (data, actions) {
						return actions.order.capture().then(async function (details) {
							var buyerMailEl = document.getElementById('buyermail');
							var buyerMail = buyerMailEl.value;
							var couponEl = document.getElementById('coupon');
							var usedCoupon = couponEl.value;
							var previews = document.getElementsByName('item-preview');
							var formData = JSON.stringify({
								orderId: details.id,
								buyerMail: buyerMail,
								coupon: usedCoupon,
								items: cart_items
							});

							//change page layout
							document.getElementById('tables').style.display = 'none';
							document.getElementById('bag-state').src = 'img/bagdone.png';
							document.getElementById('shipping-total').remove();
							document.getElementById('buyermail').remove();
							document.getElementById('coupon').remove();
							document.getElementById('emailvalidator').remove();
							document.getElementById('grand-total').remove();
							document.getElementById('coupon-status').remove();

							return fetch(api_path+'/order', {
								method: 'POST',
								cache: 'no-cache',
								headers:{
									'Content-Type': 'application/json'
								},
								body: formData
							}).then(()=>{
								clearCart();
								paypalButtons.forEach(btn => btn.close());
							});
						});
					},
					onError: function(err){
						location.reload();
					}
				});
				// Check if the button is eligible
				if(button.isEligible()){
					// Render the standalone button for that funding source
					paypalButtons.push(button);
					button.render(divContainer);
				}
			});
		}
		else{
			//await paypal sdk to load
			setTimeout(loadPaypalButtons, 50);
		}
	}
	loadPaypalButtons();
</script>

</div>
</body>

<!--

　　　          ___   .--.
　　　    .--.-"   "-' .- |
　　　   / .-,`          .'   
　　　   \   `           \ 　　　　　　。・゜ 　♡   。　　・　゜ 　　　♡  
　　　    '.            ・ \　　　　　　　　　　　　　　　　　　　　　　　　♡　　　　♡ ゜・。。♡  
　　　      |  ・     ᴥ    。|　　　　・゜♡ ゜・。　　. * ・ ♡ °  . 。
　　　      \ 。            /.____　　　　　　　　　　　　　　　　　　♡.  
　　　     /`-.          ,'.'    `\　　　　　　　　　　　　　　　　　　。・゜　　　 ♡ ・ 。　　。・゜ ♡  
　　　  __/   \`-.____.-' `\      /　　　　　♡　。・゜      
　　　  | `---`'-'._/-`     \----'    _ 　　　　　　　　　　　♡　　　.　　　.♡ 
　　　  |,-'`  /             |    _.-' `\　　　　. * ・        
　　　 .'     /              |--'`     / |　　　　　　　　　　 ♡
　　　/      /\              `         | |
　　　|   .\/  \      .--. __          \ |　　　　　　　　　　　*.。middlepot.com 
　　　 '-'      '._       /  `\         /　　　　　　　　　　　　　　　　　　　　　　　ଘ(*´ ˘ `*)ഒ 。.*
　　　             `\    '     |------'`
　　　               \  |      |
　　　                \        /
 　　　                '._  _.'

-->

</html>